<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé® √ñzelle≈ütirmeleri Ekle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 3rem;
        }

        h1 {
            font-size: 2rem;
            color: #2d2f2e;
            margin-bottom: 1rem;
            text-align: center;
        }

        .step {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1.5rem 0;
            border-left: 4px solid #667eea;
        }

        .step h2 {
            color: #667eea;
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .editor {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            margin: 1rem 0;
        }

        .json-key {
            color: #9cdcfe;
        }

        .json-string {
            color: #ce9178;
        }

        .json-number {
            color: #b5cea8;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            margin-top: 1rem;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        code {
            background: #f0f0f0;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #667eea;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .file-label:hover {
            background: #5568d3;
        }

        .file-status {
            margin-left: 1rem;
            color: #666;
        }
    </style>
</head>

<body>
    <div class="card">
        <h1>üé® Framer HTML'e √ñzelle≈ütirme Ekle</h1>

        <div class="step">
            <h2>1Ô∏è‚É£ √ñzelle≈ütirmelerinizi Tanƒ±mlayƒ±n</h2>
            <p>Deƒüi≈ütirmek istediƒüiniz metinleri, renkleri ve diƒüer ayarlarƒ± JSON formatƒ±nda girin:</p>

            <textarea id="jsonInput" placeholder='√ñrnek:
{
  "texts": {
    "LOVERA": "MYAGENCY",
    "Product design": "Web Tasarƒ±m"
  },
  "colors": {
    "--token-9a91e853-f5c6-46a5-8fa7-05be67b4c926": "#0066ff"
  },
  "pageTitle": "My Agency",
  "metaDescription": "Professional agency",
  "favicon": "https://example.com/favicon.png",
  "logo": "https://example.com/logo.png"
}'>{
  "texts": {
    "LOVERA": "MYAGENCY",
    "Product design": "Web Tasarƒ±m",
    "Content strategy": "ƒ∞√ßerik Stratejisi",
    "Brand identity design": "Marka Kimliƒüi",
    "Web development": "Web Geli≈ütirme"
  },
  "colors": {
    "--token-9a91e853-f5c6-46a5-8fa7-05be67b4c926": "#0066ff"
  },
  "pageTitle": "My Agency - Creative Studio",
  "metaDescription": "Professional creative agency",
  "favicon": "https://example.com/favicon.png",
  "logo": "https://example.com/logo.png"
}</textarea>

            <button class="btn" onclick="validateJSON()">‚úÖ JSON'u Doƒürula</button>
            <div id="jsonAlert" class="alert"></div>
        </div>

        <div class="step">
            <h2>2Ô∏è‚É£ Framer HTML Dosyasƒ±nƒ± Se√ßin</h2>
            <p><code>page-original-framer.html</code> dosyanƒ±zƒ± se√ßin:</p>

            <label class="file-label" for="htmlFile">üìÑ HTML Dosyasƒ± Se√ß</label>
            <input type="file" id="htmlFile" class="file-input" accept=".html">
            <span id="htmlStatus" class="file-status"></span>
        </div>

        <div class="step">
            <h2>3Ô∏è‚É£ √ñzelle≈ütirilmi≈ü HTML'i ƒ∞ndirin</h2>
            <button class="btn" id="processBtn" onclick="processHTML()" disabled>
                ‚ú® ƒ∞≈üle ve ƒ∞ndir
            </button>
            <div id="processAlert" class="alert"></div>
        </div>
    </div>

    <script>
        let htmlContent = null;
        let jsonData = null;

        // JSON doƒürula
        function validateJSON() {
            const jsonInput = document.getElementById('jsonInput');
            const alert = document.getElementById('jsonAlert');

            try {
                jsonData = JSON.parse(jsonInput.value);
                alert.className = 'alert success';
                alert.textContent = '‚úÖ JSON ge√ßerli! ' +
                    (jsonData.texts ? Object.keys(jsonData.texts).length + ' metin, ' : '') +
                    (jsonData.colors ? Object.keys(jsonData.colors).length + ' renk tanƒ±mlƒ±' : '');

                checkReadyToProcess();
            } catch (error) {
                alert.className = 'alert error';
                alert.textContent = '‚ùå JSON hatasƒ±: ' + error.message;
                jsonData = null;
            }
        }

        // HTML dosyasƒ± se√ßildiƒüinde
        document.getElementById('htmlFile').addEventListener('change', function (e) {
            const file = e.target.files[0];
            const status = document.getElementById('htmlStatus');

            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    htmlContent = event.target.result;
                    status.textContent = '‚úÖ ' + file.name + ' y√ºklendi';
                    status.style.color = '#155724';
                    checkReadyToProcess();
                };
                reader.readAsText(file);
            }
        });

        // ƒ∞≈üleme hazƒ±r mƒ± kontrol et
        function checkReadyToProcess() {
            const btn = document.getElementById('processBtn');
            btn.disabled = !(htmlContent && jsonData);
        }

        // HTML'i i≈üle
        function processHTML() {
            const alert = document.getElementById('processAlert');

            try {
                // √ñzelle≈ütirme script'ini olu≈ütur
                const customScript = `
<script id="customization-system">
${generateCustomizationScript()}
<\/script>`;

                // Script'i </body> etiketinden √∂nce ekle
                let modifiedHTML = htmlContent.replace('</body>', customScript + '\n</body>');

                // ƒ∞ndir
                const blob = new Blob([modifiedHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'page-customized-' + Date.now() + '.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert.className = 'alert success';
                alert.innerHTML = `
                    <strong>‚úÖ Ba≈üarƒ±lƒ±!</strong><br>
                    √ñzelle≈ütirilmi≈ü HTML dosyasƒ± indirildi!<br>
                    <br>
                    <strong>Sonraki Adƒ±mlar:</strong><br>
                    1. ƒ∞ndirilen dosyayƒ± tarayƒ±cƒ±da a√ßƒ±n<br>
                    2. Deƒüi≈üikliklerin uygulandƒ±ƒüƒ±nƒ± kontrol edin<br>
                    3. Hosting'e y√ºkleyin
                `;

            } catch (error) {
                alert.className = 'alert error';
                alert.textContent = '‚ùå Hata: ' + error.message;
            }
        }

        // √ñzelle≈ütirme script'ini olu≈ütur (OPTIMIZE EDƒ∞LMƒ∞≈û)
        function generateCustomizationScript() {
            // Metinleri Map'e √ßevir (daha hƒ±zlƒ± arama)
            const textsMap = jsonData.texts || {};

            return `
(function() {
    'use strict';
    
    console.log('üé® √ñzelle≈ütirme sistemi ba≈ülatƒ±lƒ±yor...');
    
    // Metinleri Map olarak sakla (daha hƒ±zlƒ±)
    const textsMap = new Map(${JSON.stringify(Object.entries(textsMap))});
    const colors = ${JSON.stringify(jsonData.colors || {})};
    const pageTitle = ${JSON.stringify(jsonData.pageTitle || '')};
    const metaDesc = ${JSON.stringify(jsonData.metaDescription || '')};
    
    let isApplying = false;
    let appliedCount = 0;
    let maxAttempts = 3;
    let attemptCount = 0;
    
    function replaceTexts() {
        if (isApplying || textsMap.size === 0) return;
        
        isApplying = true;
        let count = 0;
        const startTime = performance.now();
        
        try {
            const walker = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_TEXT,
                {
                    acceptNode: function(node) {
                        const parent = node.parentElement;
                        if (parent && ['SCRIPT', 'STYLE', 'NOSCRIPT'].includes(parent.tagName)) {
                            return NodeFilter.FILTER_REJECT;
                        }
                        return NodeFilter.FILTER_ACCEPT;
                    }
                },
                false
            );
            
            const nodesToChange = [];
            while (walker.nextNode()) {
                const node = walker.currentNode;
                const text = node.nodeValue ? node.nodeValue.trim() : '';
                if (text && textsMap.has(text)) {
                    nodesToChange.push({ node, oldText: text, newText: textsMap.get(text) });
                }
            }
            
            // Batch update (daha hƒ±zlƒ±)
            nodesToChange.forEach(({ node, oldText, newText }) => {
                node.nodeValue = node.nodeValue.replace(oldText, newText);
                count++;
            });
            
            appliedCount += count;
            const duration = (performance.now() - startTime).toFixed(2);
            
            if (count > 0) {
                console.log('‚úÖ ' + count + ' metin deƒüi≈ütirildi (' + duration + 'ms)');
            }
        } catch (error) {
            console.error('‚ùå Hata:', error);
        } finally {
            isApplying = false;
        }
    }
    
    function replaceColors() {
        if (!colors || Object.keys(colors).length === 0) return;
        
        const root = document.documentElement;
        Object.entries(colors).forEach(([cssVar, color]) => {
            root.style.setProperty(cssVar, color);
        });
        console.log('‚úÖ Renkler g√ºncellendi');
    }
    
    function replaceMeta() {
        if (pageTitle) document.title = pageTitle;
        if (metaDesc) {
            const meta = document.querySelector('meta[name="description"]');
            if (meta) meta.content = metaDesc;
        }
    }
    
    function replaceFavicon() {
        const faviconUrl = ${JSON.stringify(jsonData.favicon || '')};
        if (!faviconUrl) return;
        
        // Mevcut favicon'larƒ± bul ve deƒüi≈ütir
        const favicons = document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]');
        favicons.forEach(link => {
            link.href = faviconUrl;
        });
        
        // Yoksa yeni ekle
        if (favicons.length === 0) {
            const link = document.createElement('link');
            link.rel = 'icon';
            link.href = faviconUrl;
            document.head.appendChild(link);
        }
        
        console.log('‚úÖ Favicon g√ºncellendi');
    }
    
    function replaceLogo() {
        const logoUrl = ${JSON.stringify(jsonData.logo || '')};
        if (!logoUrl) return;
        
        // Logo resimlerini bul ve deƒüi≈ütir
        const logos = document.querySelectorAll('img[alt*="logo" i], img[class*="logo" i], .logo img, [class*="logo"] img');
        let count = 0;
        
        logos.forEach(img => {
            img.src = logoUrl;
            img.srcset = ''; // srcset'i temizle
            count++;
        });
        
        if (count > 0) {
            console.log('‚úÖ ' + count + ' logo g√ºncellendi');
        }
    }
    
    function applyAll() {
        attemptCount++;
        replaceTexts();
        replaceColors();
        replaceMeta();
        replaceFavicon();
        replaceLogo();
        
        // Maksimum deneme sayƒ±sƒ±na ula≈üƒ±ldƒ±ysa observer'ƒ± durdur
        if (attemptCount >= maxAttempts) {
            if (observer) {
                observer.disconnect();
                console.log('‚úÖ √ñzelle≈ütirme tamamlandƒ±. Toplam: ' + appliedCount + ' metin');
            }
        }
    }
    
    // ƒ∞lk uygulama
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(applyAll, 500);
            setTimeout(applyAll, 1500);
            setTimeout(applyAll, 3000);
        });
    } else {
        setTimeout(applyAll, 500);
        setTimeout(applyAll, 1500);
        setTimeout(applyAll, 3000);
    }
    
    // DOM deƒüi≈üikliklerini izle (THROTTLED - performans i√ßin)
    let observerTimeout;
    const observer = new MutationObserver(() => {
        if (attemptCount >= maxAttempts) {
            observer.disconnect();
            return;
        }
        
        // Throttle: 500ms'de bir √ßalƒ±≈ü
        clearTimeout(observerTimeout);
        observerTimeout = setTimeout(() => {
            replaceTexts();
        }, 500);
    });
    
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
    
    console.log('‚úÖ √ñzelle≈ütirme sistemi aktif! (' + textsMap.size + ' metin)');
})();
`;
        }
    </script>
</body>

</html>